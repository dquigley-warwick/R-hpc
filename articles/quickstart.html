<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Rhpc">
<title>Quick Start • Rhpc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start">
<meta property="og:description" content="Rhpc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Rhpc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/quickstart.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/rscript.html">R on HPC</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mschubert/clustermq">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quick Start</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mschubert/R-hpc/blob/HEAD/vignettes/quickstart.Rmd" class="external-link"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<style type="text/css">
img {
    border: 0px !important;
    margin: 2em 2em 2em 2em !important;
}
code {
    border: 0px !important;
}
</style>
<div class="section level3">
<h3 id="setting-up-r">Setting up R<a class="anchor" aria-label="anchor" href="#setting-up-r"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> R</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load GCC/11.2.0 OpenMPI/4.1.1 R/4.1.2</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> R</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="r-from-the-command-line">R from the command line<a class="anchor" aria-label="anchor" href="#r-from-the-command-line"></a>
</h3>
</div>
<div class="section level3">
<h3 id="running-an-interactive-job">Running an interactive job<a class="anchor" aria-label="anchor" href="#running-an-interactive-job"></a>
</h3>
<p>The simplest way to request an interactive job is to use Slurm’s <code>srun</code> command where we specify that we want to run a shell (specified by the <code>$SHELL</code> environment variable) that is connected to our terminal input and output (<code>--pty</code>). In addition, we need to specify the account our requested resources will be budgeted to (<code>--account</code>) We can do that by running:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--account</span> su105 <span class="at">--pty</span> <span class="va">$SHELL</span></span></code></pre></div>
<p>You will see that your command prompt changes from <code>user@login</code> to <code>user$nodeXX</code>, which means that we are now connected to a compute node instead of the login node. Here, we are allowed to run heavy computations within the resource constraints that we specified.</p>
<p>First, let’s get an overview of which processes are already running on this node. This we can do by running the resource monitor <code>htop</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">htop</span></span></code></pre></div>
<p>In this overview, we can see how many cores the compute node has, how many processes are running, and how much memory is used. Depending on how much of those resources we requested (and the overall load), we will see that at least our resource allocation is still free. We do, however, need to stay within our allocation (and not the overall amount of available resources), because otherwise our processes will be terminated automatically.</p>
<p>If we have loaded the R module beforehand, we’ll see that the <code>$PATH</code> (the environment variable where our shell looks for executables) is still set up to include R. We can check this by asking for the R path:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> R</span></code></pre></div>
<p>We can then run or via the command-line, as we can on our local machines as well. This will give us an R command prompt:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span></code></pre></div>
<pre><code><span class="co">#&gt; </span>
<span class="co">#&gt; R version 4.1.2 (2021-11-01) -- "Bird Hippie"</span>
<span class="co">#&gt; Copyright (C) 2021 The R Foundation for Statistical Computing</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R is free software and comes with ABSOLUTELY NO WARRANTY.</span>
<span class="co">#&gt; You are welcome to redistribute it under certain conditions.</span>
<span class="co">#&gt; Type 'license()' or 'licence()' for distribution details.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Natural language support but running in an English locale</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R is a collaborative project with many contributors.</span>
<span class="co">#&gt; Type 'contributors()' for more information and</span>
<span class="co">#&gt; 'citation()' on how to cite R or R packages in publications.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Type 'demo()' for some demos, 'help()' for on-line help, or</span>
<span class="co">#&gt; 'help.start()' for an HTML browser interface to help.</span>
<span class="co">#&gt; Type 'q()' to quit R.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; &gt; quit()</span></code></pre>
<p>We can use <code>R</code> as we could use the R shell in e.g. RStudio as well:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">y</span> <span class="op">=</span> <span class="fl">3</span>
<span class="va">x</span> <span class="op">*</span> <span class="va">y</span>
<span class="co">#&gt; [1] 15</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="editing-files">Editing files<a class="anchor" aria-label="anchor" href="#editing-files"></a>
</h3>
</div>
<div class="section level3">
<h3 id="compute-resources">Compute resources<a class="anchor" aria-label="anchor" href="#compute-resources"></a>
</h3>
<p>For now, we have submitted our job while specifying only the minimum required parameters and relying on the defaults for others. For instance, we have not specific a <code>partition</code>, which is one of several job queues that we can submit our jobs to. To get an overview of which are available, we can use the <code>sinfo</code> command:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sinfo</span></span></code></pre></div>
<p>Here, we see the different partitions listed and a number of nodes associated with each of them, including the walltime (maximum amount of time that a job can request) for each queue. You will see that one queue is marked with a <code>*</code>. This denotes the default queue, which we have been using by not specifying any particular queue via the <code>--partition</code> parameter.</p>
<p>One argument that we did specify but not explain in more detail is the <code>account</code>. This specifies the connection between your user name and a collection of resources available that you can use, which are then subtracted from this budget. You can check which accounts your user has access to by typing:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sacctmgr</span> show associations where user=<span class="op">&lt;</span>your user name<span class="op">&gt;</span></span></code></pre></div>
<p>You will likely only belong to one account, or project, at this time (which was the one created for this course).</p>
</div>
<div class="section level3">
<h3 id="job-submission-scripts">Job submission scripts<a class="anchor" aria-label="anchor" href="#job-submission-scripts"></a>
</h3>
<p>Usually, you will want to run more complex computations than can be specified with a single <code>srun</code>. For running multiple commands on multiple hosts, it is often better to specify the resource requirements and exact commands using a job submission script. This may look like the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --account su105</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --partition compute</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks 1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task 1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem 1024M</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> uname <span class="at">-n</span></span></code></pre></div>
<p>We can submit this script by saving it to a script file and then running <code>sbatch &lt;script&gt;</code>. It should tell us something like</p>
<blockquote>
<p>Submitted batch job 1290046</p>
</blockquote>
<p>where the number is the identifier of the job (and will be different with multiple runs).</p>
<p>This will create an output file called <code>slurm-xxxxxx.out</code> (where <code>xxxxxx</code> is the job id) with the standard output of the command (the standard output is what would have otherwise been printed to the console).</p>
<p>There’s quite a few lines in there, so let’s break this down:</p>
<ul>
<li>
<code>#!/bin/sh</code> is called a shebang and specifies which application should be used to run the script, which is required by <code>sbatch</code> (otherwise it will refuse to submit the job)</li>
<li>
<code>#SBATCH --account</code> is needed again to budget the resources correctly</li>
<li>
<code>#SBATCH --parititon</code> this time we specific the <code>compute</code> partition explicitly</li>
<li>
<code>#SBATCH --ntasks</code> lists the tasks (computations) this job contains</li>
<li>
<code>#SBATCH --cpus-per-task</code> specifies the numbers of CPUs per task</li>
<li>
<code>#SBATCH --mem</code> specifies the amount of memory requested; this is in total, other options include <code>--mem-per-task</code>, <code>--mem-per-cpu</code>, or <code>--mem-per-gpu</code>. Memory multipliers such as <code>K</code>, <code>M</code> and <code>G</code> are supported.</li>
<li>
<code>#SBATCH</code> commands need to be directly following the shebang, otherwise they will be ignored</li>
<li>
<code>srun</code> specifies the command to be run; it is not required for running individual computations, but helps set up parallel helpers, such as running the call once per task, or e.g. setting up MPI if this is used</li>
</ul>
</div>
<div class="section level3">
<h3 id="exercise">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<ul>
<li>Create a batch submission script using the editor on the cluster</li>
<li>Submit it using <code>sbatch &lt;script&gt;</code>, both with and without the <code>srun</code>. What changes?</li>
<li>What happens with we change the <code>ntasks</code> paramter to <code>2</code>, both with and without the <code>srun</code> command?</li>
</ul>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Schubert.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
